---
## Front matter
lang: ru-RU
title: Лабораторная работа №9
subtitle: Администрирование сетевых подсистем
author:
  - Иванов Сергей Владимирович, НПИбд-01-23
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 18 октября 2025

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
 - '\makeatletter'
 - '\beamer@ignorenonframefalse'
 - '\makeatother'

 ## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
---

## Цель работы

Приобретение практических навыков по установке и простейшему конфигурированию POP3/IMAP-сервера.

## Задание

1. Установите на виртуальной машине server Dovecot и Telnet для дальнейшей проверки корректности работы почтового сервера 
2. Настройте Dovecot 
3. Установите на виртуальной машине client программу для чтения почты Evolution
и настройте её для манипуляций с почтой вашего пользователя. Проверьте корректность работы почтового сервера как с виртуальной машины server, так
и с виртуальной машины client 
4. Измените скрипт для Vagrant, фиксирующий действия по установке и настройке
Postfix и Dovecote в виртуальной машине server, создайте
скрипт, фиксирующий действия по установке Evolution в виртуальной машине client. 

# Выполнение работы

## Установка Dovecot

На виртуальной машине server войдем под пользователем и откроем терминал. Перейдем в режим суперпользователя. Установим необходимые для работы пакеты. (рис. 1).

![Установка dovecot telnet](image/1.png){#fig:001 width=70%}

## Настройка dovecot

В конфигурационном файле /etc/dovecot/dovecot.conf пропишем список почтовых протоколов, по которым разрешено работать Dovecot (рис. 2).

![Файл dovecot.conf](image/2.png){#fig:002 width=70%}

## Настройка dovecot

В конфигурационном файле /etc/dovecot/conf.d/10-auth.conf проверим, что указан метод аутентификации plain. (рис. 3)

![Файл 10-auth.conf](image/3.png){#fig:003 width=70%}

## Настройка dovecot

В конфигурационном файле /etc/dovecot/conf.d/auth-system.conf.ext проверим,
что для поиска пользователей и их паролей используется pam и файл passwd. (рис. 4, 5) 

![Файл auth-system.conf.ext](image/4.png){#fig:004 width=70%}

## Настройка dovecot

![Файл auth-system.conf.ext](image/5.png){#fig:005 width=70%}

## Настройка dovecot

В конфигурационном файле /etc/dovecot/conf.d/10-mail.conf настроим месторасположение почтовых ящиков пользователей. (рис. 6)

![Файл 10-mail.conf](image/6.png){#fig:006 width=70%}

## Настройка dovecot

В Postfix зададим каталог для доставки почты: (рис. 7)

![Каталог для доставки почты](image/7.png){#fig:007 width=70%}

## Настройка dovecot

Сконфигурируем межсетевой экран, разрешив работать службам протоколов POP3
и IMAP: (рис. 8)

![Межсетевой экран](image/8.png){#fig:008 width=70%}

## Настройка dovecot

Восстановим контекст безопасности в SELinux: (рис. 9)

![Восстановление SELinux](image/9.png){#fig:009 width=70%}

## Настройка dovecot

Перезапустим Postfix и запустим Dovecot: (рис. 10)

![Перезапуск Postfix и запуск Dovecot](image/10.png){#fig:010 width=70%}

## Проверка работы Dovecot

На дополнительном терминале виртуальной машины server запустим мониторинг
работы почтовой службы: (рис. 11)

![Мониторинг почты](image/11.png){#fig:011 width=70%}

## Проверка работы Dovecot

На терминале сервера для просмотра имеющейся почты используем MAIL=~/Maildir mail. Писем нет (рис. 12)

![Просмотр почты](image/12.png){#fig:012 width=70%}

## Проверка работы Dovecot

Для просмотра mailbox пользователя на сервере на терминале с правами суперпользователя используем команду (рис. 13)

![Просмотр mailbox](image/13.png){#fig:013 width=70%}
 
## Проверка работы Dovecot

На виртуальной машине client войдем под пользователем и откроем терминал. Перейдем в режим суперпользователя. Установим почтовый клиент. (рис. 14)

![Установка evolution на client](image/14.png){#fig:014 width=70%}

## Проверка работы Dovecot

Запустим и настроим почтовый клиент Evolution: в окне настройки учётной записи почты укажем имя, адрес почты (рис. 15)

![Настройка учетной записи Evolution](image/15.png){#fig:015 width=70%}

## Проверка работы Dovecot

В качестве IMAP-сервера для входящих сообщений пропишем mail.svivanov.net, пользователя укажем svivanov. Проверим номер порта (143). Проверим настройки SSL и метод аутентификации: STARTTLS,
аутентификация по обычному паролю. (рис. 16)

![Настройка IMAP](image/16.png){#fig:016 width=70%}

## Проверка работы Dovecot

В качестве SMTP-сервера для исходящих сообщений пропишем mail.svivanov.net, пользователя укажем svivanov. Проверим номер порта (25).
Проверим настройки SSL и метод аутентификации: без аутентификации (рис. 17)

![Настройка SMTP](image/17.png){#fig:017 width=70%}

## Проверка работы Dovecot

Из почтового клиента отправим себе несколько тестовых писем. (рис. 18, 19)

![Отправка писем себе](image/18.png){#fig:018 width=70%}

## Проверка работы Dovecot

![Отправка писем себе](image/19.png){#fig:019 width=70%}

## Проверка работы Dovecot

Убедимся, что они доставлены. Видим, что это так. (рис. 20)

![Доставленные письма](image/20.png){#fig:020 width=70%}

## Проверка работы Dovecot

Посмотрим, какие сообщения выдаются при мониторинге почтовой
службы на сервере. Видим, что все письма доставлены. status = sent. (рис. 21)

![Мониторинг почтовой службы](image/21.png){#fig:021 width=70%}

## Проверка работы Dovecot

Посмотрим, какие сообщения выдаются при использовании mail. mail показывает все 5 писем, их можно прямо там же просмотреть (рис. 22)

![Использование команды mail](image/22.png){#fig:022 width=70%}

## Проверка работы Dovecot

Посмотрим, какие сообщения выдаются при использовании doveadm. Результат тот же, INBOX. (рис. 23)

![Использование команды doveadm](image/23.png){#fig:023 width=70%}

## Проверка работы Dovecot

Проверим работу почтовой службы, используя на сервере протокол Telnet: подключимся с помощью протокола Telnet к почтовому серверу по протоколу
POP3, введем свой логин для подключения и пароль: (рис. 24)

![Использование telnet](image/24.png){#fig:024 width=70%}

## Проверка работы Dovecot

С помощью команды list получим список писем (рис. 25)

![Команда list](image/25.png){#fig:025 width=70%}

## Проверка работы Dovecot

С помощью команды retr 1 получим первое письмо из списка (рис. 26)

![Команда retr 1](image/26.png){#fig:026 width=70%}

## Проверка работы Dovecot

С помощью команды dele 2 удалим второе письмо из списка (рис. 27)

![Команда dele 2](image/27.png){#fig:027 width=70%}

## Проверка работы Dovecot

С помощью команды quit завершим сеанс работы с telnet (рис. 28)

![Команда quit](image/28.png){#fig:028 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На машине server перейдем в каталог для внесения изменений в настройки внутреннего окружения. В соответствующие подкаталоги поместим конф. файлы Dovecot: (рис. 29)

![Замена конф. файлов](image/29.png){#fig:029 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Внесем изменения в серипт mail.sh, добавив в него
строки: по установке Dovecot и Telnet; по настройке межсетевого экрана; по настройке Postfix в части задания месторасположения почтового ящика; по перезапуску Postfix и запуску Dovecot. (рис. 30)

## Внесение изменений в настройки внутреннего окружения виртуальной машины

![Редактирование mail.sh](image/30.png){#fig:030 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине client в каталоге /vagrant/provision/client скорректируем файл mail.sh, прописав в нём (рис. 31)

![Редактирование mail.sh на клиенте](image/31.png){#fig:031 width=70%}

# Вывод

## Вывод 

В ходе выполнения лабораторной работы мы приобрели приобрели практические навыки по установке и простейшему конфигурированию POP3/IMAP-сервера.








 
